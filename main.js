(()=>{"use strict";function e(e,n,o,r,c,i){var a=n.content.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image");u.src=e.link,u.name=e.name,u.alt=e.name;var s=a.querySelector(".card__like-count");s.textContent=e.likes.length;var l=a.querySelector(".card__delete-button");e.owner._id===i?l.addEventListener("click",(function(){o(e._id,a)})):l.remove(),a.querySelector(".card__title").textContent=e.name;var d=a.querySelector(".card__like-button");return t(e.likes,i)&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(){c(e,d,s)})),u.addEventListener("click",(function(){r(e.link,e.name)})),a}function t(e,t){return e.some((function(e){return e._id===t}))}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function o(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function c(e,t){var n=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((function(n){a(e,n,t)})),i(o,n,t.inactiveButtonClass)}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)}function a(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n.inputErrorClass,n.errorClass):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n.inputErrorClass,n.errorClass)}var u="https://mesto.nomoreparties.co/v1/wff-cohort-38",s="7ec4ef4b-01f1-46d3-9ab5-eed9e2b11fd9",l="application/json";function d(e){return e.ok&&p(e)?e.json():function(e){return p(e)?e.json().then((function(t){return Promise.reject({code:e.status,message:null===t.message?"Непредвиденная ошибка":t.message})})):Promise.reject({code:e.status,message:"При выполнении запроса: ".concat(res.url," возникла непредвиденная ошибка")})}(e)}function p(e){return e.headers.get("content-type").includes("application/json")}var m,f,_=document.querySelectorAll(".popup"),y=document.querySelector("#card-template"),v=document.querySelector(".places__list"),h=document.querySelector(".popup_type_image"),S=h.querySelector("img"),q=h.querySelector(".popup__caption"),C=document.querySelector(".profile__edit-button"),E=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup__form[name=edit-profile]"),k=document.querySelector(".profile__image-container"),L=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_avatar"),z=T.querySelector("input[name=link]"),A=T.querySelector(".popup__form[name=edit-avatar]"),B=E.querySelector("input[name=name]"),P=E.querySelector("input[name=description]"),j=document.querySelector(".profile__add-button"),w=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup__form[name=new-place]"),N=document.querySelector(".popup_type_delete_confirm"),O=N.querySelector(".popup__form[name=delete-confirm]"),J=w.querySelector("input[name=place-name]"),M=w.querySelector("input[name=link]"),G=document.querySelector(".popup_type_error"),H=G.querySelector(".popup__title"),V=G.querySelector(".popup__error-message"),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function F(e){H.textContent="Ошибка ".concat(e.code),V.textContent=e.message,n(G)}function I(e,t){S.src=e,S.alt=t,q.textContent=t,n(h)}function K(e,t){e.querySelector(".popup__button").textContent=t}function Q(e,t){O.removeEventListener("submit",f),f=function(){(function(e){return fetch("".concat(u,"/cards/").concat(e),{method:"DELETE",headers:{authorization:s}}).then(d)})(e).then((function(){!function(e){e.remove()}(t)})).catch(F),r(N)},O.addEventListener("submit",f),n(N)}function R(e,n,o){var r;t(e.likes,m)?(r=e._id,fetch("".concat(u,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:s}}).then(d)).then((function(t){e.likes=t.likes,o.textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})):function(e){return fetch("".concat(u,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:s}}).then(d)}(e._id).then((function(t){e.likes=t.likes,o.textContent=e.likes.length,n.classList.add("card__like-button_is-active")}))}Promise.all([fetch("".concat(u,"/users/me"),{method:"GET",headers:{authorization:s}}).then(d),fetch("".concat(u,"/cards"),{method:"GET",headers:{authorization:s}}).then(d)]).then((function(t){var n=t[0];L.textContent=n.name,g.textContent=n.about,x.src=n.avatar,m=n._id,t[1].forEach((function(t){v.append(e(t,y,Q,I,R,m))}))})).catch(F),_.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&r(e)}))})),C.addEventListener("click",(function(e){B.value=L.textContent,P.value=g.textContent,c(b,U),n(E)})),b.addEventListener("submit",(function(e){e.preventDefault(),K(b,"Сохранение..."),function(e,t){return fetch("".concat(u,"/users/me"),{method:"PATCH",headers:{authorization:s,"Content-Type":l},body:JSON.stringify({name:e,about:t})}).then(d)}(B.value,P.value).then((function(e){L.textContent=e.name,g.textContent=e.about})).catch(F).finally((function(){return K(b,"Сохранить")})),r(E)})),j.addEventListener("click",(function(e){c(D,U),n(w)})),D.addEventListener("submit",(function(t){var n,o;t.preventDefault(),K(D,"Сохранение..."),(n=J.value,o=M.value,fetch("".concat(u,"/cards"),{method:"POST",headers:{authorization:s,"Content-Type":l},body:JSON.stringify({name:n,link:o})}).then(d)).then((function(t){v.prepend(e(t,y,Q,I,R,m)),D.reset()})).catch(F).finally((function(){return K(D,"Сохранить")})),r(w)})),k.addEventListener("click",(function(e){z.value=x.src,c(A,U),n(T)})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),K(A,"Сохранение..."),(t=z.value,fetch("".concat(u,"/users/me/avatar"),{method:"PATCH",headers:{authorization:s,"Content-Type":l},body:JSON.stringify({avatar:t})}).then(d)).then((function(e){x.src=e.avatar})).catch(F).finally((function(){return K(A,"Сохранить")})),r(T)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){a(e,r,t),i(n,o,t.inactiveButtonClass)}))}))}(t,e)}))}(U)})();